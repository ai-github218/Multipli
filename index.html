<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>掛け算ゲーム</title>
<style>
  body { font-family: sans-serif; text-align: center; margin-top: 50px; }
  #result { font-weight: bold; font-size: 1.2em; margin: 10px 0; }
  #time { font-size: 1.2em; color: blue; }
  input { font-size: 1.2em; padding: 5px; width: 80px; text-align: center; }
</style>
</head>
<body>

<h1>掛け算ゲーム</h1>

<p>残り時間: <span id="time">30</span>秒</p>

<p>レベル: <span id="level">1</span></p>

<h2 id="question"></h2>

<input type="text" id="answer" placeholder="答えを入力">

<p id="result"></p>

<p>スコア: <span id="score">0</span></p>
<p>連続正解: <span id="combo">0</span></p>
<p>最大連続: <span id="maxCombo">0</span></p>

<script>
let num1, num2;
let score = 0;
let time = 30;
let timer;
let level = 1;
let correctCount = 0;
let questionStartTime;

let combo = 0;       // 連続正解
let maxCombo = 0;    // 最大連続

// 新しい問題
function newQuestion() {

    const digits = level;

    const min = Math.pow(10, digits - 1);
    const max = Math.pow(10, digits) - 1;

    num1 = Math.floor(Math.random() * (max - min + 1)) + min;
    num2 = Math.floor(Math.random() * 9) + 1;

    document.getElementById("question").textContent =
         num1 + " × " + num2 + " = ?";

    document.getElementById("answer").value = "";
    document.getElementById("answer").focus();

    questionStartTime = Date.now();
}

// タイマー
function startTimer() {
    timer = setInterval(() => {
        time--;
        document.getElementById("time").textContent = time;

        if(time <= 0){
            clearInterval(timer);
            document.getElementById("result").textContent = "⏰ 時間切れ！ゲーム終了";
            document.getElementById("answer").disabled = true;
        }
    }, 1000);
}

// 回答チェック
function check() {
    if(time <= 0) return;

    const ans = Number(document.getElementById("answer").value);
    const correctAnswer = num1 * num2;

    const answerTime = (Date.now() - questionStartTime) / 1000;
    let addScore = 0;

    if(ans === correctAnswer){

        if(answerTime < 2){
            addScore = 3;
        } else if(answerTime < 4){
            addScore = 2;
        } else {
            addScore = 1;
        }

        score += addScore;
        correctCount++;

        combo++; // 連続正解＋１

        if(combo > maxCombo){
            maxCombo = combo;
        }

        document.getElementById("result").textContent =
            "✅ +" + addScore + "点 (" + answerTime.toFixed(1) + "秒)";
        document.getElementById("result").style.color = "green";

        if(correctCount % 5 === 0){
            level++;
            document.getElementById("level").textContent = level;
        }

    } else {

        combo = 0; // ミスでリセット

        document.getElementById("result").textContent =
            "❌ 正解は " + correctAnswer;
        document.getElementById("result").style.color = "red";
    }

    document.getElementById("score").textContent = score;
    document.getElementById("combo").textContent = combo;
    document.getElementById("maxCombo").textContent = maxCombo;

    newQuestion();
}

// Enterキーで回答
document.getElementById("answer").addEventListener("keydown", function(e){
    if(e.key === "Enter"){
        check();
    }
});

newQuestion();
startTimer();
</script>

</body>
</html>
